<section class="ug-product-recommendations page-width" aria-label="Product recommendations">
  {% if recommendations.performed and recommendations.products_count > 0 %}
    <h2 class="ug-product-recommendations__title">{{ section.settings.heading }}</h2>
    <ul class="ug-product-recommendations__grid">
      {% for product in recommendations.products limit: section.settings.products_to_show %}
        <li>{% render 'ug-card-product', product: product %}</li>
      {% endfor %}
    </ul>
  {% endif %}
</section>

<script>
  fetch(window.Shopify.routes.root + 'recommendations/products?product_id={{ product.id }}&limit=4')
    .then(r => r.json())
    .then(data => {
      if (data.products && data.products.length) {
        const section = document.querySelector('.ug-product-recommendations');
        if (section) {
          const grid = section.querySelector('.ug-product-recommendations__grid');
          if (grid) {
            grid.innerHTML = data.products.map(p => `
              <li>
                <article class="ug-card-product">
                  <a href="${p.url}">
                    <div class="ug-card-product__media"><img src="${p.featured_image}" alt="${p.title}" loading="lazy"></div>
                    <div class="ug-card-product__info"><h3>${p.title}</h3><span>${p.price}</span></div>
                  </a>
                </article>
              </li>
            `).join('');
          }
          section.querySelector('.ug-product-recommendations__title').style.display = 'block';
        }
      }
    });
</script>

{% schema %}
{
  "name": "Product recommendations",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "You may also like" },
    { "type": "range", "id": "products_to_show", "min": 2, "max": 6, "step": 1, "default": 4, "label": "Products to show" }
  ]
}
{% endschema %}
